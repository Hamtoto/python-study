# Face-Tracking-App: DUAL 모드 개발 및 오류 수정 보고서

**문서 목적**: 2025년 8월 1일에 진행된 DUAL 모드 기능 구현 및 관련 버그 수정 과정을 기록합니다.

---

## 1. 초기 문제 상황

`dual.sh` 스크립트 실행 시, 다수의 `GStreamer warning: Internal data stream error`가 발생하며 최종적으로 비디오 처리에 실패함. 생성된 리포트에는 `총 프레임 수: 0`, `생성된 세그먼트: 0개`로 표시되어, 비디오 파일을 전혀 읽지 못하는 것으로 확인됨.

---

## 2. 개발 및 디버깅 과정

### 가설 1: 병렬 처리로 인한 파일 접근 충돌
- **현상**: 여러 프로세스가 동시에 임시 비디오 파일에 접근하며 오류가 발생한다고 추정.
- **조치**: `multiprocessing.Pool`을 사용한 병렬 처리를 `for` 루프를 이용한 순차 처리로 변경.
- **결과**: **실패.** 동일한 GStreamer 오류가 계속 발생하여, 병렬 처리가 근본 원인이 아님을 확인.

### 가설 2: 잘못된 세그먼트 생성 방식
- **현상**: FFmpeg의 `-c copy` 옵션이 키프레임이 아닌 지점에서 파일을 잘라 불안정한 세그먼트를 생성한다고 추정.
- **조치**: 세그먼트 생성 시 스트림 복사 대신 재인코딩하도록 FFmpeg 명령어 수정.
- **결과**: **실패.** 여전히 동일 오류 발생.

### 가설 3: 요구사항 불일치 및 핵심 로직 오류
- **현상**: 사용자의 피드백을 통해 **"DUAL 모드는 두 명의 화자에 대해 각각 SINGLE 모드처럼 10초 단위 클립을 생성해야 한다"**는 핵심 요구사항을 명확히 함. 기존 로직은 VAD(음성 감지) 기반의 가변 길이 클립을 생성하려 했으므로 요구사항과 완전히 달랐음.
- **조치**:
    1. `process_dual_mode_segments` 함수의 로직을 전면 재설계.
    2. 영상 전체에서 상위 2명의 화자를 식별.
    3. 각 화자에 대해 SINGLE 모드와 동일하게, 해당 인물이 등장하는 타임라인을 추출하여 10초 단위로 분할 및 저장하는 로직으로 변경.
- **결과**: **성공.** DUAL 모드가 정상적으로 동작하고, 각 화자별로 10초 단위 세그먼트가 포함된 폴더를 생성함.

### 가설 4: 리포트 로그 누락
- **현상**: DUAL 모드 실행 후, 최종 리포트에 처리 결과(프레임 수, 세그먼트 수 등)가 `0`으로 표시됨.
- **조치**: DUAL 모드 처리 로직 마지막에, 성능 리포터 객체에 최종 처리 정보를 업데이트하는 `reporter.set_processing_info()` 호출 코드가 누락된 것을 확인하고 추가함.
- **결과**: **성공.** 리포트에 모든 처리 정보가 정상적으로 출력됨.

---

## 3. 최종 해결 내용

- DUAL 모드의 요구사항을 명확히 하여, **상위 2명의 화자에 대해 각각 10초 단위의 세그먼트를 생성**하도록 핵심 로직을 수정함.
- 최종 리포트에 처리 결과가 정상적으로 기록되도록 누락된 코드를 추가함.

---

## 4. 현재 상태

- **SINGLE 모드**: 정상 동작 확인 완료.
- **DUAL 모드**: 수정된 요구사항에 맞춰 정상 동작 확인 완료.
- **성능**: DUAL 모드는 두 명의 화자를 처리하므로 SINGLE 모드에 비해 처리 시간이 더 소요되며, 이는 정상적인 결과임.
